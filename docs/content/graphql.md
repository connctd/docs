---
title: GraphQL API
order: 9
---

We are offering a Graph QL which makes it easier to perform tasks like creating/searching/resolving things.
See our [Tutorial](https://tutorial.connctd.io/tutorials/5/pages/1) in case you need a proper introduction in using our GraphQL API.
We highly recommend using a GraphQL Editor (e.g. integrated in Postman) when playing around with our API.

<aside class="notice">
  When doing requests against our things endpoint you have to pass two headers for a successful request handling:
    <ul>
      <li>Authorization:Bearer -your token-</li>
      <li>X-External-Subject-Id:-any id (e.g. customer id) generated by your app-</li>
    </ul>
</aside>


## Querying

All queries have to be sent against the following endpoint:

> **Request**<br>
> POST https://api.connctd.io/api/v1/query<br>
> *Headers:*<br>
> &nbsp;Content-Type:application/json<br>
> &nbsp;Authorization:YOUR TOKEN<br>
> &nbsp;X-External-Subject-Id:SUBJECT_ID<br>
> *Body:* {"query":"a valid gql query see examples below"}<br>

<aside class="notice">
  Please note: the following queries are structured to improve readability. You can use these queries as show in case you are using a proper gql editor (e.g. integrated in postman). If you send it as a rough json object it needs to be condensed into one single line and put into the "envelope" object like shown above.
</aside>

### Example 1: Query things and components
```graphql
query {
	things {
		name,
		components {
			id,
			name
		}
	}
}
```

same as

```json
{"query":"query {things {name,components{id,name}}}"}
```

### Example 2: Query things with certain properties
```graphql
query{
	things(thingConstraint: {name: "ExampleOven"}, thingComponentConstraint: {name: "Door"}){
		name
	}
}
```

same as

```json
{"query":"query{things(thingConstraint: {name:\"ExampleOven\"}, thingComponentConstraint: {name: \"Door\"}){name}}"}
```

### Example 3: Query units
```graphql
query {
	units {
		name
	}
}
```

### Example 4: Query units with certain properties
```graphql
query{
	units(unitConstraint: {name:"ExampleKitchen", type:"room"}) {
		name
	}
}
```

### Example 5: Query historic thing values with criteria
```graphql
query {
    things(thingConstraint: {id: "1e999269-a90c-41a3-b388-0eef1d810317"}) {
        id
        name
        components {
            name
            properties {
                name
                history(from: "2020-04-01T22:00:00Z", to: "2020-04-30T22:00:00Z", first: 5, after: "eyJ0aW1lIjoiMjAyMC0wNC0xM1QxNToyOTo1MC44OTA0MTVaIn0=") {
                    totalCount
                    pageInfo {
                        hasNextPage
                        endCursor
                    }
                    edges {
                        node {
                            timestamp
                            value
                        }
                        cursor
                    }
                }
            }
        }
    }
}
```

## Mutation

All queries have to be sent against the following endpoint:

> **Request**<br>
> POST https://api.connctd.io/api/v1/query<br>
> *Headers:*<br>
> &nbsp;Content-Type:application/json<br>
> &nbsp;Authorization:YOUR TOKEN<br>
> &nbsp;X-External-Subject-Id:SUBJECT_ID<br>
> *Body:* see examples below<br>

### Example 1: Create thing and return its id
```graphql
mutation{
	createThing(thing: {
			name: "My Example Thing",
			manufacturer: "connctd",
			displayType: "core.SIREN",
			mainComponentId: "siren",
			status: AVAILABLE,
			components: [{
				id: "siren",
				name: "Siren",
				componentType: "core.SIREN",
				capabilities: ["core.SWITCH"],
				properties: [{
					id: "on",
					name: "on",
					value: "false",
					unit: "",
					type: BOOLEAN,
					propertyType: "core.ONOFF"
				}],
				actions: [{
					id: "setOn", name: "setOn", parameters: [{
						name: "on",
						type: BOOLEAN
					}]
				}]
			}]
		}
	) {
		id
	}
}
```

### Example 2: Create a unit and return its id
```graphql
mutation{
	createUnit(unit: {name: "ExampleUnit", type: "GROUP"}) {
		id
	}
}
```


### Connectors

```graphql
query {
    connectorPublications {
        id
        name
        logoUrl
        homeUrl
        description
        requirements
        tags
        active
        public
        configurationParameters {
            id
            name
            required
            description
            valueType
            displayType
            validationExpression
        }
        customerConfigurationParameters {
            id
            name
            required
            description
            valueType
            displayType
            validationExpression
        }
    }
}
```

active: A connector can be deactivated to indicate a maintanance process is going on or the technology is no longer supported. By default a connector is active. Deactivating a connector means no further messages get routed from or to the externally hosted connector service. Status of all related things will switch from AVAILABLE to UNAVAILABLE. Also no further installations of that connector can be done as long as it is deactivated.

public: If set to true the connector is visible in connector store. If set to false its only visible in connector store if the connector belongs to you.

```graphql
mutation {
    publishConnector(connector: {
        name: "Pandelis super connector"
        logoUrl: "https://anyurl.com",
        homeUrl: "https://anyurl.com",
        description: "Hello world",
        requirements: "Do this and that",
        public: true,
        tags: ["tagOne","tagTwo"],
        configurationParameters: [
            {
                id: "clientid",
                name: "Client ID",
                required: true,
                description: "Bla",
                valueType: STRING,
                displayType: PLAIN,
                validationExpression: ""
            }
        ],
        customerConfigurationParameters: [
            {
                id: "name",
                name: "Your name",
                required: false,
                description: "dummy",
                valueType: STRING,
                displayType: PASSWORD,
                validationExpression: ""
            }
        ],
        addConfigurationCallbackUrl: "https://anyurl.com",
        removeConfigurationCallbackUrl: "https://anyurl.com",
        updateConfigurationCallbackUrl: "https://anyurl.com",
        addInstanceCallbackUrl: "https://anyurl.com",
        removeInstanceCallbackUrl: "https://anyurl.com",
        updateInstanceCallbackUrl: "https://anyurl.com",
        performActionCallbackUrl: "https://anyurl.com",
        cancelActionCallbackUrl: "https://anyurl.com"
    }) {
        id
        name
        logoUrl
        homeUrl
        description
        requirements
        public
        active
        configurationParameters {
            id
            name
            required
            description
            valueType
            validationExpression
        }
        customerConfigurationParameters {
            id
            name
            required
            description
            valueType
            validationExpression
        }
        addConfigurationCallbackUrl
        removeConfigurationCallbackUrl
        updateConfigurationCallbackUrl
        addInstanceCallbackUrl
        removeInstanceCallbackUrl
        updateInstanceCallbackUrl
        performActionCallbackUrl
        cancelActionCallbackUrl
        verificationId
    }
}
```

```graphql
query {
    connectorStoreItems {
        id
        name
        logoUrl
        homeUrl
        description
        requirements
        tags
        configurationParameters {
            id
            name
            required
            description
            valueType
            displayType
            validationExpression
        }
        customerConfigurationParameters {
            id
            name
            required
            description
            valueType
            displayType
            validationExpression
        }
    }
}
```