---
title: GraphQL API
order: 9
legacy: false
---
import KeyUtilities from "../../components/KeyUtilities"
import { Button } from "@connctd/quartz"
import {BsDownload} from "react-icons/bs"
import {css} from "@emotion/core"

We are offering a Graph QL which makes it easier to perform tasks like creating/searching/resolving things.
See our [Tutorial](https://tutorial.connctd.io/tutorials/5/pages/1) in case you need a proper introduction in using our GraphQL API.
We highly recommend using a GraphQL Editor (e.g. integrated in Postman) when playing around with our API.

<aside class="notice">
  When doing requests against our things endpoint you have to pass two headers for a successful request handling:
    <ul>
      <li>Authorization:Bearer -your token-</li>
      <li>X-External-Subject-Id:-any id (e.g. customer id) generated by your app-</li>
    </ul>
</aside>

## Utilities

The connctd GraphQL endpoint exists behind an authentication layer which can make
obtaining the schema for testing or exploring the API slightly cumbersome. For that reason
we have created some helpers for authenticating against the API purely for exploring the schema
or automatically generating type safe GraphQL code for your language of choice.

The GraphQL endpoint has full support for schema introspection so you can choose to generate
your own types with your own API keys should you wish to do so.

### Obtain a key for exploring the schema

You can obtain a key with 30minutes of validity from `https://docs.connctd.io/api/querykey`

> **Request**<br/>
> GET https://docs.connctd.io/api/querykey


Or for convinience you can grab a valid generated key right here:

<div class="generatedKeys">
	<KeyUtilities />
</div>



### Schema Download

Download an up to date Schema Definition (SDL) for use with postman or your tooling of choice to help you with
autocompletion.

<Button
	text={<span style={{color: "white"}}>SDL Download <BsDownload size="1.2em" /></span>}
	style={{textDecoration: "none"}}
	appearance="secondary"
	href="/api/schema" />


## Querying

All queries have to be sent against the following endpoint:

> **Request**<br/>
> POST https://api.connctd.io/api/v1/query<br/>
> *Headers:*<br/>
> &nbsp;Content-Type:application/json<br/>
> &nbsp;Authorization:YOUR TOKEN<br/>
> &nbsp;X-External-Subject-Id:SUBJECT_ID<br/>
> *Body:* {"query":"a valid gql query see examples below"}<br/>

<aside class="notice">
  Please note: the following queries are structured to improve readability. You can use these queries as show in case you are using a proper gql editor (e.g. integrated in postman). If you send it as a rough json object it needs to be condensed into one single line and put into the "envelope" object like shown above.
</aside>

### Example 1: Query things and components
```graphql
query {
	things {
		name,
		components {
			id,
			name
		}
	}
}
```

same as

```json
{"query":"query {things {name,components{id,name}}}"}
```

### Example 2: Query things with certain properties
```graphql
query{
	things(thingConstraint: {name: "ExampleOven"}, thingComponentConstraint: {name: "Door"}){
		name
	}
}
```

same as

```json
{"query":"query{things(thingConstraint: {name:\"ExampleOven\"}, thingComponentConstraint: {name: \"Door\"}){name}}"}
```

### Example 3: Query units
```graphql
query {
	units {
		name
	}
}
```

### Example 4: Query units with certain properties
```graphql
query{
	units(unitConstraint: {name:"ExampleKitchen", type:"room"}) {
		name
	}
}
```

### Example 5: Query historic thing values with criteria
```graphql
query {
    things(thingConstraint: {id: "1e999269-a90c-41a3-b388-0eef1d810317"}) {
        id
        name
        components {
            name
            properties {
                name
                history(from: "2020-04-01T22:00:00Z", to: "2020-04-30T22:00:00Z", first: 5, after: "eyJ0aW1lIjoiMjAyMC0wNC0xM1QxNToyOTo1MC44OTA0MTVaIn0=") {
                    totalCount
                    pageInfo {
                        hasNextPage
                        endCursor
                    }
                    edges {
                        node {
                            timestamp
                            value
                        }
                        cursor
                    }
                }
            }
        }
    }
}
```

## Mutation

All queries have to be sent against the following endpoint:

> **Request**<br/>
> POST https://api.connctd.io/api/v1/query<br/>
> *Headers:*<br/>
> &nbsp;Content-Type:application/json<br/>
> &nbsp;Authorization:YOUR TOKEN<br/>
> &nbsp;X-External-Subject-Id:SUBJECT_ID<br/>
> *Body:* see examples below<br/>

### Example 1: Create thing and return its id
```graphql
mutation{
	createThing(thing: {
			name: "My Example Thing",
			manufacturer: "connctd",
			displayType: "core.SIREN",
			mainComponentId: "siren",
			status: AVAILABLE,
			components: [{
				id: "siren",
				name: "Siren",
				componentType: "core.SIREN",
				capabilities: ["core.SWITCH"],
				properties: [{
					id: "on",
					name: "on",
					value: "false",
					unit: "",
					type: BOOLEAN,
					propertyType: "core.ONOFF"
				}],
				actions: [{
					id: "setOn", name: "setOn", parameters: [{
						name: "on",
						type: BOOLEAN
					}]
				}]
			}]
		}
	) {
		id
	}
}
```

### Example 2: Create a unit and return its id
```graphql
mutation{
	createUnit(unit: {name: "ExampleUnit", type: "GROUP"}) {
		id
	}
}
```


